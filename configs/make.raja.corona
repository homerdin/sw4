# modules loaded should look like
#1) texlive/2016   2) StdEnv (S)   3) opt   4) rocm/3.6.0   5) openmpi-gnu/4.0   6) gnu/8.2.1
#use make -f Makefile.hipcc
proj = yes
FC = gfortran
LINKER = hipcc
CXX = $(PREP) hipcc
ckernel=yes 
openmp=no
raja_cuda=yes
#RAJA_LOCATION = /gpfs/alpine/geo130/proj-shared/sw4_raja/LIBS/RAJA/install
#RAJA_LOCATION  = /autofs/nccs-svm1_home1/rameshp/RAJA/RAJA-0.7.0/install_gcc_5.4
#RAJA_LOCATION = /autofs/nccs-svm1_home1/rameshp/RAJA/RAJA-0.7.0/install
RAJA_LOCATION = /home/users/coe0145/RAJA/RAJA/install_rocm_default
RAJA_LOCATION = /home/users/coe0145/RAJA/RAJA/install_no_gpu_rdc
RAJA_LOCATION = /home/users/coe0145/RAJA/RAJA_11/RAJA-v0.11.0/install2
RAJA_LOCATION = /usr/workspace/wsb/ramesh/CORAL2/CORONA/RAJA/install
RAJA_LOCATION = /usr/workspace/wsb/ramesh/RAJA/2020/RAJA-v0.12.1/install_corona
#RAJA_LOCATION = /home/users/coe0145/RAJA/Dev/raja/install
PROJ_HOME = /gpfs/alpine/geo130/proj-shared/sw4_raja/LIBS/proj-5.0.0/install_12_27_2018
PROJ_HOME = /home/users/coe0145/Umpire/Proj5/proj-5.0.0/install
PROJ_HOME = /usr/workspace/wsb/ramesh/CORAL2/CORONA/proj-5.0.0/install
#UMPIRE_HOME = /gpfs/alpine/geo130/proj-shared/sw4_raja/LIBS/Umpire/install_summit_gcc4.8.5
#UMPIRE_HOME = /gpfs/alpine/geo130/proj-shared/sw4_raja/LIBS/Umpire/install_summit_xl
UMPIRE_HOME = /home/users/coe0145/Umpire/Umpire2/Umpire/installx3
UMPIRE_HOME = /home/users/coe0145/Umpire/Umpire4/Umpire/install
UMPIRE_HOME = /usr/workspace/wsb/ramesh/CORAL2/CORONA/Umpire/install
UMPIRE_HOME = /usr/workspace/wsb/ramesh/Umpire/umpire-4.0.1/install_corona
CALIPER_LOCATION = /gpfs/alpine/geo130/proj-shared/sw4_raja/LIBS/Caliper/install_summit
HIP_ROOT_DIR = $(HIP_PATH)
GCC_LINK_LINE = -L $(HIP_ROOT_DIR)/lib -lhsa-runtime64  -lm -lstdc++ -lgfortran -ldl
CUDA_HOME = $(OLCF_CUDA_ROOT)
MPI_HOME =  /opt/openmpi/4.0/gnu
EXTRA_FORT_FLAGS = 
MORE_FLAGS = -DENABLE_MPI_TIMING_BARRIER=1 -DSW4_RAJA_VERSION=7 -DSW4_PINNED_MPI_BUFFERS=1 -DSW4_USE_UMPIRE=1 -I$(MPI_HOME)/include -I${ROCM_PATH}/include -isystem /opt/rocm-3.6.0/llvm/lib/clang/11.0.0/include/.. -isystem /opt/rocm-3.6.0/hsa/include -isystem /opt/rocm-3.6.0/hip/include -D__HIP_ARCH_GFX906__=1 --cuda-gpu-arch=gfx906 --hip-device-lib-path=/opt/rocm-3.6.0/lib -O2 -x hip -Wno-inconsistent-missing-override --amdgpu-target=gfx906 -fgpu-rdc -DUSE_DIRECT_INVERSE=1
LINKFLAGS =  -std=c++11  
EXTRA_CXX_FLAGS =  -O3  -x hip -DDISABLE_PREFETCH  -std=c++11 -I $(CUDA_HOME)/include -I$(UMPIRE_HOME)/include -I$(RAJA_LOCATION)/include  -I$(CALIPER_LOCATION)/include -DUSE_NVTX -DRAJA_USE_CUDA -DSW5_CROUTINES -DRAJA_USE_RESTRICT_PTR -DCUDA_CODE -DENABLE_HIP -I$(PROJ_HOME)/include $(MORE_FLAGS) -Wno-inconsistent-missing-override 

EXTRA_CXX_FLAGS2 =  -O3  -DDISABLE_PREFETCH -std=c++11 -I $(CUDA_HOME)/include -I$(UMPIRE_HOME)/include -I$(RAJA_LOCATION)/include  -DUSE_NVTX -DRAJA_USE_CUDA -DSW4_CROUTINES -DRAJA_USE_RESTRICT_PTR -DCUDA_CODE -DENABLE_HIP   $(MORE_FLAGS)

EXTRA_LINK_FLAGS = -fgpu-rdc  -O3  -std=c++11 -L $(BLASDIR)/lib/ -L $(LAPACK_DIR)/lib64  -lgfortran -llapack -lblas  -L $(RAJA_LOCATION)/lib -lRAJA -L $(PROJ_HOME)/lib64 -lproj -L $(MPI_HOME)/lib -lmpi -L $(UMPIRE_HOME)/lib -lumpire $(GCC_LINK_LINE) 
